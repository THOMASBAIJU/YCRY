<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YCRY - Premium Parenting</title>
    
    <!-- CSS Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    
    <!-- Tailwind Config for Premium Theme -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        warm: {
                            cream: '#FFF9F5',
                            teal: '#38B2AC',
                            'teal-light': '#B2F5EA',
                            yellow: '#FAF089',
                            coral: '#FC8181',
                            green: '#68D391',
                            dark: '#1A202C',
                            gray: '#4A5568',
                        }
                    },
                    fontFamily: {
                        display: ['Nunito', 'sans-serif'],
                        body: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-warm-cream font-body text-warm-dark min-h-screen flex flex-col relative overflow-x-hidden selection:bg-warm-teal selection:text-white">
    <!-- Fluid Background Canvas -->
    <canvas id="bg-canvas"></canvas>

    <!-- Antigravity Background Blobs -->
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>
    <div class="blob blob-3"></div>

    <!-- Navigation -->
    <nav class="nav-premium sticky top-0 z-50 transition-all duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-20 items-center">
                <!-- Brand -->
                <a href="/" class="flex items-center gap-2 group">
                    <span class="text-3xl transform group-hover:scale-110 transition duration-300">üß∏</span>
                    <span class="font-display font-extrabold text-2xl tracking-tight text-warm-dark group-hover:text-warm-teal transition-colors">YCRY</span>
                </a>

                <!-- Desktop Menu -->
                <div class="hidden md:flex items-center space-x-1">
                    {% if session.get('user') %}
                        <a href="/" class="px-4 py-2 rounded-full font-bold text-sm text-warm-gray hover:text-warm-teal hover:bg-white/50 transition">Home</a>
                        <a href="/cry" class="px-4 py-2 rounded-full font-bold text-sm text-warm-gray hover:text-warm-teal hover:bg-white/50 transition">Cries</a>
                        <a href="/vaccine" class="px-4 py-2 rounded-full font-bold text-sm text-warm-gray hover:text-warm-teal hover:bg-white/50 transition">Vaccines</a>
                        <a href="/growth" class="px-4 py-2 rounded-full font-bold text-sm text-warm-gray hover:text-warm-teal hover:bg-white/50 transition">Growth</a>
                        
                        <!-- Care Dropdown -->
                        <div class="relative group">
                            <button class="px-4 py-2 rounded-full font-bold text-sm text-warm-gray hover:text-warm-teal hover:bg-white/50 transition flex items-center gap-1">
                                Care ‚ñæ
                            </button>
                            <div class="absolute top-full left-0 mt-2 w-48 bg-white rounded-2xl shadow-xl overflow-hidden hidden group-hover:block border border-gray-100">
                                <a href="/nutrition" class="block px-4 py-3 text-sm font-bold text-warm-gray hover:bg-warm-teal hover:text-white transition">ü•ï Nutrition</a>
                                <a href="/exercises" class="block px-4 py-3 text-sm font-bold text-warm-gray hover:bg-warm-teal hover:text-white transition">ü§∏‚Äç‚ôÇÔ∏è Exercises</a>
                                <a href="/health" class="block px-4 py-3 text-sm font-bold text-warm-gray hover:bg-warm-coral hover:text-white transition">ü©∫ Health Check</a>
                            </div>
                        </div>
                        <a href="{{ url_for('assistant') }}" class="px-4 py-2 rounded-full font-bold text-sm text-warm-coral hover:text-warm-teal hover:bg-white/50 transition">Dr. YCRY</a>
                        <a href="/profile" class="ml-2 pl-2 pr-4 py-1.5 rounded-full font-bold text-sm text-warm-gray hover:text-warm-teal hover:bg-white/50 transition flex items-center gap-2">
                            {% if navbar_pic %}
                                <img src="{{ url_for('static', filename='profile_pics/' + navbar_pic) }}" class="w-8 h-8 rounded-full object-cover border-2 border-warm-teal">
                            {% else %}
                                üë∂
                            {% endif %}
                            Profile
                        </a>
                        <a href="/logout" class="ml-4 px-6 py-2 rounded-full font-bold text-sm bg-warm-coral text-white shadow-md hover:shadow-lg hover:scale-105 transition">Logout</a>
                    {% else %}
                        <a href="/login" class="px-6 py-2 rounded-full font-bold text-sm text-warm-gray hover:text-warm-teal transition">Login</a>
                        <a href="/register" class="ml-2 px-6 py-2 rounded-full font-bold text-sm bg-warm-teal text-white shadow-md hover:shadow-lg hover:scale-105 transition">Get Started</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </nav>
    
    </div>

    <!-- Global Notification Container (Fixed) -->
    <div id="toast-container" class="fixed top-24 right-4 z-[9999] flex flex-col gap-3 pointer-events-none"></div>

    <!-- Hidden Flash Data for JS Bridge -->
    <div id="flash-data" class="hidden" data-messages='[
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    {"msg": "{{ message }}", "cat": "{{ category }}"}{{ "," if not loop.last else "" }}
                {% endfor %}
            {% endif %}
        {% endwith %}
    ]'></div>

    <script>
        // Global Toast Notification System
        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            
            // Icons & Colors
            const config = {
                success: { icon: 'üéâ', border: 'border-warm-green', text: 'text-green-700', bg: 'bg-white' },
                error:   { icon: 'üß∏', border: 'border-warm-coral', text: 'text-red-700',   bg: 'bg-white' },
                info:    { icon: 'ü§î', border: 'border-warm-teal',  text: 'text-blue-700',  bg: 'bg-white' }
            };
            const style = config[type] || config.info;

            // Create Element
            const toast = document.createElement('div');
            toast.className = `pointer-events-auto transform translate-x-full transition-all duration-500 ease-out glass-premium p-4 rounded-xl shadow-2xl flex items-center gap-4 border-l-4 ${style.border} ${style.text} min-w-[300px] max-w-sm`;
            toast.innerHTML = `
                <span class="text-2xl">${style.icon}</span>
                <p class="font-bold text-sm flex-grow">${message}</p>
                <button onclick="this.parentElement.remove()" class="text-warm-gray hover:text-warm-dark font-bold text-lg">&times;</button>
            `;

            // Append & Animate
            container.appendChild(toast);
            
            // Trigger animation after render
            requestAnimationFrame(() => {
                toast.classList.remove('translate-x-full');
            });

            // Auto Remove
            setTimeout(() => {
                toast.classList.add('opacity-0', 'translate-x-full');
                setTimeout(() => toast.remove(), 500);
            }, 5000);
        }

        // Bridge Flask Flash Messages to Toast System
        document.addEventListener('DOMContentLoaded', () => {
            const flashDataEl = document.getElementById('flash-data');
            let flashMessages = [];
            
            try {
                // Parse the JSON string from the data attribute
                // We use || "[]" to handle cases where the attribute might be empty or malformed
                const rawData = flashDataEl.getAttribute('data-messages');
                if (rawData) {
                    flashMessages = JSON.parse(rawData);
                }
            } catch (e) {
                console.error("Error parsing flash messages:", e);
            }
            
            flashMessages.forEach((flash, index) => {
                setTimeout(() => {
                    // Map Flask 'message' category to 'info'
                    let type = flash.cat === 'message' ? 'info' : flash.cat; 
                    showToast(flash.msg, type);
                }, index * 300); // Stagger animations
            });
        });
    </script>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 py-8">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-100 mt-20">
        <div class="max-w-6xl mx-auto px-4 py-12">
            <div class="flex flex-col md:flex-row justify-between items-center gap-6">
                <div class="text-center md:text-left">
                    <h3 class="font-display font-extrabold text-xl text-warm-dark mb-1">YCRY.AI</h3>
                    <p class="text-warm-gray text-sm">Helping you understand your little one, one sound at a time.</p>
                </div>
                <div class="flex gap-6 text-2xl text-warm-gray">
                    <span class="hover:text-warm-teal cursor-pointer transition transform hover:scale-110">üçº</span>
                    <span class="hover:text-warm-yellow cursor-pointer transition transform hover:scale-110">‚≠ê</span>
                    <span class="hover:text-warm-coral cursor-pointer transition transform hover:scale-110">‚ù§Ô∏è</span>
                </div>
                <div class="text-xs text-warm-light font-medium">
                    &copy; 2026 YCRY Parenting. Made with love.
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        AOS.init({
            duration: 800,
            once: true,
            easing: 'ease-out-cubic'
        });
    </script>
    <!-- Smooth Scroll (Lenis) -->
    <script src="https://cdn.jsdelivr.net/gh/studio-freight/lenis@1.0.29/bundled/lenis.min.js"></script>
    <script>
        const lenis = new Lenis({
            duration: 1.2,
            easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
            direction: 'vertical',
            gestureDirection: 'vertical',
            smooth: true,
            mouseMultiplier: 1,
            smoothTouch: false,
            touchMultiplier: 2,
        });

        function raf(time) {
            lenis.raf(time);
            requestAnimationFrame(raf);
        }

        requestAnimationFrame(raf);
    </script>

    <!-- Fluid Background -->
    <script src="{{ url_for('static', filename='js/fluid_background.js') }}"></script>
</body>
</html>